{% extends "base.html" %}

{% load static %}

{% block content %}
  <main class="flex-1 w-full max-w-[90rem] mx-auto mt-6 px-4 md:px-6">
    <div class="flex flex-col md:flex-row space-y-6 md:space-y-0 md:space-x-6">
      <div class="md:w-3/4 space-y-6">
        <div class="space-y-4">
          <blockquote class="text-xl italic">
            "Somewhere, something incredible is waiting to be known."
            <span class="block text-right">- Carl Sagan</span>
          </blockquote>
          <p>
            Alpha One Labs is an innovative platform dedicated to forging
            meaningful connections between teachers and students. By bridging
            the gap between knowledge seekers and knowledge givers, we
            facilitate a dynamic educational experience that empowers everyone
            involved. Whether you're sharing expertise or searching for
            guidance, Alpha One Labs helps turn curiosity into collaborative
            learning—because when passionate minds come together, new
            understanding is always within reach.
          </p>
        </div>
        <!-- Featured Courses (3 across) -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <!-- Course Card 1 -->
          {% for course in featured_courses %}
            <!-- Course Card -->
            <div class="rounded-lg p-4 border border-gray-200 dark:border-gray-700">
              {% if course.image %}
                <a href="{% url 'course_detail' course.slug %}">
                  <img src="{{ course.image.url }}"
                       alt="{{ course.title }}"
                       class="w-full h-32 object-cover rounded mb-3"
                       width="300"
                       height="150" />
                </a>
              {% else %}
                <a href="{% url 'course_detail' course.slug %}">
                  <img src="{% static 'images/default-course.jpg' %}"
                       alt="{{ course.title }}"
                       class="w-full h-32 object-cover rounded mb-3"
                       width="300"
                       height="150" />
                </a>
              {% endif %}
              <!-- Title and Subject -->
              <div class="mb-3">
                <h3 class="text-lg font-semibold">
                  <a href="{% url 'course_detail' course.slug %}"
                     class="hover:text-orange-500 transition-colors duration-200">{{ course.title }}</a>
                </h3>
                <div class="flex items-center justify-between text-sm">
                  <span class="font-medium text-teal-600 dark:text-teal-400">{{ course.subject }}</span>
                  <span class="text-orange-600 dark:text-orange-500">
                    {% if course.price == 0 %}
                      Free
                    {% else %}
                      ${{ course.price }}
                    {% endif %}
                  </span>
                </div>
              </div>
              <!-- Course Stats -->
              <div class="grid grid-cols-2 gap-2 mb-3 text-sm">
                <div class="flex items-center text-gray-600 dark:text-gray-300">
                  <i class="fas fa-eye mr-2"></i>
                  <span>{{ course.web_requests.count|default:"0" }} views</span>
                </div>
                <div class="flex items-center text-gray-600 dark:text-gray-300">
                  <i class="fas fa-users mr-2"></i>
                  <span>{{ course.enrollments.count }}/{{ course.max_students }}</span>
                </div>
                <div class="flex items-center text-gray-600 dark:text-gray-300">
                  <i class="fas fa-calendar-alt mr-2"></i>
                  <span>{{ course.sessions.count }} sessions</span>
                </div>
                <div class="flex items-center text-gray-600 dark:text-gray-300">
                  <i class="fas fa-star text-yellow-400 mr-2"></i>
                  <span>{{ course.average_rating|default:"N/A" }}</span>
                </div>
              </div>
              <!-- Session Dates -->
              {% with first_session=course.sessions.first last_session=course.sessions.last %}
                {% if first_session and last_session %}
                  <div class="mb-3 text-sm text-gray-600 dark:text-gray-300">
                    <div class="flex items-center mb-1">
                      <i class="fas fa-calendar-day mr-2"></i>
                      <span>Starts: {{ first_session.start_time|date:"M j, Y" }}</span>
                    </div>
                    <div class="flex items-center">
                      <i class="fas fa-calendar-check mr-2"></i>
                      <span>Ends: {{ last_session.end_time|date:"M j, Y" }}</span>
                    </div>
                  </div>
                {% endif %}
              {% endwith %}
              <!-- Teacher Info -->
              <div class="flex items-center mb-3">
                {% if course.teacher.profile.avatar %}
                  <img src="{{ course.teacher.profile.avatar.url }}"
                       alt="{{ course.teacher.get_full_name|default:course.teacher.username }}"
                       class="h-12 w-12 rounded-full mr-3"
                       width="48"
                       height="48" />
                {% else %}
                  <img src="{% static 'images/default_teacher.png' %}"
                       alt="{{ course.teacher.get_full_name|default:course.teacher.username }}"
                       class="h-12 w-12 rounded-full mr-3"
                       width="48"
                       height="48" />
                {% endif %}
                <div>
                  <span class="text-sm font-medium">{{ course.teacher.get_full_name|default:course.teacher.username }}</span>
                  {% if course.teacher.profile.expertise %}
                    <p class="text-xs text-gray-600 dark:text-gray-400">{{ course.teacher.profile.expertise }}</p>
                  {% endif %}
                </div>
              </div>
              <!-- Action Button -->
              {% if course.invite_only %}
                <div class="text-xs text-indigo-600 dark:text-indigo-400 text-center">
                  <i class="fas fa-lock mr-1"></i>
                  Invite Only
                </div>
              {% else %}
                <form method="post" action="{% url 'add_course_to_cart' course.id %}">
                  {% csrf_token %}
                  <button type="submit"
                          class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold px-3 py-2 rounded-lg flex items-center justify-center">
                    <i class="fas fa-cart-plus mr-2"></i>
                    Add to Cart
                  </button>
                </form>
              {% endif %}
            </div>
          {% empty %}
            <p>No featured courses available.</p>
          {% endfor %}
        </div>
        <!-- Add view more link -->
        <div class="text-right mt-4">
          <a href="{% url 'course_search' %}"
             class="text-orange-500 hover:text-orange-600 underline transition-colors duration-200">
            <span>View More Courses</span>
            <i class="fas fa-arrow-right ml-2"></i>
          </a>
        </div>
        <!-- Two cards next to each other: For Learners & For Teachers -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- For Learners -->
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2 flex items-center">
              <i class="fa-solid fa-user-graduate text-teal-600 dark:text-teal-400 mr-2"></i>
              For Learners
            </h3>
            <ul class="list-disc list-inside space-y-2 text-sm text-gray-800 dark:text-gray-200">
              <li>
                <i class="fa-solid fa-robot text-gray-600 dark:text-gray-300 mr-2"></i>
                Advanced search with AI-powered recommendations
              </li>
              <li>
                <i class="fa-solid fa-calendar-check text-gray-600 dark:text-gray-300 mr-2"></i>
                Flexible scheduling with calendar integration
              </li>
              <li>
                <i class="fa-solid fa-trophy text-gray-600 dark:text-gray-300 mr-2"></i>
                Track your progress and earn achievements
              </li>
              <li>
                <i class="fa-solid fa-users text-gray-600 dark:text-gray-300 mr-2"></i>
                Join study groups and connect with peers
              </li>
              <li>
                <i class="fa-solid fa-chalkboard-teacher text-gray-600 dark:text-gray-300 mr-2"></i>
                Access both virtual and in-person classes
              </li>
            </ul>
          </div>
          <!-- For Teachers -->
          <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
            <h3 class="text-lg font-semibold mb-2 flex items-center">
              <i class="fa-solid fa-chalkboard-user text-teal-600 dark:text-teal-400 mr-2"></i>
              For Teachers
            </h3>
            <ul class="list-disc list-inside space-y-2 text-sm text-gray-800 dark:text-gray-200">
              <li>
                <i class="fa-solid fa-clipboard-list text-gray-600 dark:text-gray-300 mr-2"></i>
                Comprehensive course management tools
              </li>
              <li>
                <i class="fa-solid fa-chart-line text-gray-600 dark:text-gray-300 mr-2"></i>
                Analytics and student progress tracking
              </li>
              <li>
                <i class="fa-solid fa-credit-card text-gray-600 dark:text-gray-300 mr-2"></i>
                Secure payment processing and earnings management
              </li>
              <li>
                <i class="fa-solid fa-bullhorn text-gray-600 dark:text-gray-300 mr-2"></i>
                Marketing tools to promote your courses
              </li>
              <li>
                <i class="fa-solid fa-comments text-gray-600 dark:text-gray-300 mr-2"></i>
                Direct communication with students
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="md:w-1/3 space-y-6">
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <h2 class="text-xl font-semibold mb-4">
            <i class="fa-solid fa-chalkboard-user mr-2"></i>
            Teach a Course
          </h2>
          <form method="post" class="space-y-4">
            {% csrf_token %}
            {% if not user.is_authenticated or not user.profile.is_teacher %}
              {% if request.user.is_authenticated %}
                <input type="hidden" name="email" value="{{ user.email }}" />
              {% else %}
                <div>
                  <label for="email" class="block text-sm font-medium mb-1">Email</label>
                  <input type="email"
                         id="email"
                         name="email"
                         class="block w-full border {% if form.email.errors %}border-red-500 dark:border-red-500{% else %}border-gray-300 dark:border-gray-600{% endif %} rounded p-2 focus:outline-none focus:ring-2 focus:ring-teal-300 dark:focus:ring-teal-800 bg-white dark:bg-gray-800"
                         placeholder="your.email@example.com"
                         value="{{ form.email.value|default:'' }}"
                         required />
                  {% if form.email.errors %}
                    <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.email.errors|join:", " }}</p>
                  {% endif %}
                </div>
              {% endif %}
            {% endif %}
            <div>
              <label for="subject" class="block text-sm font-medium mb-1">Subject</label>
              <input type="text"
                     id="subject"
                     name="subject"
                     class="block w-full border {% if form.subject.errors %}border-red-500 dark:border-red-500{% else %}border-gray-300 dark:border-gray-600{% endif %} rounded p-2 focus:outline-none focus:ring-2 focus:ring-teal-300 dark:focus:ring-teal-800 bg-white dark:bg-gray-800"
                     placeholder="Your subject to teach"
                     value="{{ form.subject.value|default:'' }}"
                     required />
              {% if form.subject.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.subject.errors|join:", " }}</p>
              {% endif %}
            </div>
            <div>
              <label for="captcha" class="block text-sm font-medium mb-1">Verification</label>
              <div class="{% if form.captcha.errors %}border border-red-500 dark:border-red-500 rounded p-2{% endif %}">
                {{ form.captcha }}
              </div>
              {% if form.captcha.errors %}
                <p class="mt-1 text-sm text-red-600 dark:text-red-400">{{ form.captcha.errors|join:", " }}</p>
              {% endif %}
            </div>
            <button type="submit"
                    class="bg-orange-500 hover:bg-orange-600 text-white font-semibold px-4 py-2 rounded-full flex items-center">
              <i class="fa-solid fa-arrow-right-to-bracket mr-2"></i> Continue
            </button>
          </form>
        </div>
        <!-- Recent Forum Post -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2 flex items-center">
            <i class="fa-solid fa-comments text-purple-600 dark:text-purple-400 mr-2"></i>
            Recent Forum Post
          </h2>
          <p class="text-sm">
            <strong class="block text-gray-900 dark:text-gray-200 mb-1">{{ latest_topic.title|default:"How to get started with advanced mathematics?" }}</strong>
            "{{ latest_topic.content|default:"I'm looking for resources on group theory and number theory. Any recommendations?" }}" — <em>posted by {{ latest_topic.author.username|default:"user123" }}</em>
          </p>
          <a href="{% if latest_topic %}{% url 'forum_topic' latest_topic.category.slug latest_topic.id %}{% else %}{% url 'forum_categories' %}{% endif %}"
             class="text-orange-500 dark:text-orange-400 text-sm hover:underline inline-block mt-2">View Discussion →</a>
        </div>
        <!-- Recent Blog Post -->
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
          <h2 class="text-lg font-semibold mb-2 flex items-center">
            <i class="fa-solid fa-blog text-red-600 dark:text-red-400 mr-2"></i>
            Recent Blog Post
          </h2>
          <p class="text-sm">
            <strong class="block text-gray-900 dark:text-gray-200 mb-1">{{ latest_post.title|default:"The Future of Online Education" }}</strong>
            {{ latest_post.excerpt|default:"Learn how new technologies are shaping the way we teach and learn, including AI-driven insights and personalized curriculum..." }}
          </p>
          <a href="{% if latest_post %}{% url 'blog_detail' latest_post.slug %}{% else %}{% url 'blog' %}{% endif %}"
             class="text-orange-500 dark:text-orange-400 text-sm hover:underline inline-block mt-2">Read More →</a>
        </div>
      </div>
    </div>
  </main>
{% endblock content %}
